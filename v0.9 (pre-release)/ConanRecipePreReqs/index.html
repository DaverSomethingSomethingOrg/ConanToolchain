
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://daversomethingsomethingorg.github.io/ConanToolchain/v0.9 (pre-release)/ConanRecipePreReqs/">
      
      
        <link rel="prev" href="../SampleUsage/">
      
      
        <link rel="next" href="../CIWorkflows/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.8">
    
    
      
        <title>Conan Setup and Recipe Pre-requisites - Toolchain Build System using Conan</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#conan-setup-and-recipe-pre-requisites" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Toolchain Build System using Conan" class="md-header__button md-logo" aria-label="Toolchain Build System using Conan" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Toolchain Build System using Conan
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Conan Setup and Recipe Pre-requisites
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/DaverSomethingSomethingOrg/ConanToolchain" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Toolchain Build System using Conan" class="md-nav__button md-logo" aria-label="Toolchain Build System using Conan" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Toolchain Build System using Conan
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/DaverSomethingSomethingOrg/ConanToolchain" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ButWhy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    But Why?
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SampleUsage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Conan Setup and Recipe Pre-requisites
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Conan Setup and Recipe Pre-requisites
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install_prefix-option-in-conanfilepy-for-each-non-relocatable-tool-in-the-chain" class="md-nav__link">
    <span class="md-ellipsis">
      install_prefix option in conanfile.py for each non-relocatable tool in the chain
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-conan-recipe-index" class="md-nav__link">
    <span class="md-ellipsis">
      Local Conan recipe index
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Local Conan recipe index">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maintaining-the-conan-package-index" class="md-nav__link">
    <span class="md-ellipsis">
      Maintaining the Conan Package Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-issues-with-conan-center-index-packages-for-system-package-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Common Issues with conan-center-index packages for System Package deployment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Issues with conan-center-index packages for System Package deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#license-file-conflicts" class="md-nav__link">
    <span class="md-ellipsis">
      license File Conflicts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="license File Conflicts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixing-it-in-conanfilepy" class="md-nav__link">
    <span class="md-ellipsis">
      Fixing it in conanfile.py
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overriding-it-in-deployer" class="md-nav__link">
    <span class="md-ellipsis">
      Overriding it in deployer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-conflicts" class="md-nav__link">
    <span class="md-ellipsis">
      Other Conflicts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../CIWorkflows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI Workflows
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../DemoMultiPhase/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Demo - MultiPhase GCC Compiler Bootstrap Build
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../LICENSE.txt" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apache License v2.0
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install_prefix-option-in-conanfilepy-for-each-non-relocatable-tool-in-the-chain" class="md-nav__link">
    <span class="md-ellipsis">
      install_prefix option in conanfile.py for each non-relocatable tool in the chain
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-conan-recipe-index" class="md-nav__link">
    <span class="md-ellipsis">
      Local Conan recipe index
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Local Conan recipe index">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maintaining-the-conan-package-index" class="md-nav__link">
    <span class="md-ellipsis">
      Maintaining the Conan Package Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-issues-with-conan-center-index-packages-for-system-package-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Common Issues with conan-center-index packages for System Package deployment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Issues with conan-center-index packages for System Package deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#license-file-conflicts" class="md-nav__link">
    <span class="md-ellipsis">
      license File Conflicts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="license File Conflicts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixing-it-in-conanfilepy" class="md-nav__link">
    <span class="md-ellipsis">
      Fixing it in conanfile.py
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overriding-it-in-deployer" class="md-nav__link">
    <span class="md-ellipsis">
      Overriding it in deployer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-conflicts" class="md-nav__link">
    <span class="md-ellipsis">
      Other Conflicts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="conan-setup-and-recipe-pre-requisites">Conan Setup and Recipe Pre-requisites<a class="headerlink" href="#conan-setup-and-recipe-pre-requisites" title="Permanent link">#</a></h1>
<p>You will very likely need to maintain custom(ized) Conan recipes in order
to use this system.  If you are starting from scratch, you can find good
recipes to work from in the
<a href="https://github.com/conan-io/conan-center-index/tree/master/recipes">Conan Center Index</a></p>
<h2 id="install_prefix-option-in-conanfilepy-for-each-non-relocatable-tool-in-the-chain"><code>install_prefix</code> option in conanfile.py for each non-relocatable tool in the chain<a class="headerlink" href="#install_prefix-option-in-conanfilepy-for-each-non-relocatable-tool-in-the-chain" title="Permanent link">#</a></h2>
<p>Non-relocatable packages require support for our <code>install_prefix</code> option.</p>
<p>For GNU tools, the Conan <a href="https://docs.conan.io/2/integrations/autotools.html"><code>Autotools</code></a>
integration already supports the autoconf <code>--prefix</code> option, so it's a
simple recipe modification.  Again, while it's ideal to use across all
tools, most GNU tools are relocatable and do not require this modification.</p>
<ul>
<li>generate() needs to pass in this prefix when constructing <code>AutotoolsToolchain</code></li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">:</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">tc</span> <span class="o">=</span> <span class="n">AutotoolsToolchain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">)</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">tc</span> <span class="o">=</span> <span class="n">AutotoolsToolchain</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></code></pre></div>
<div class="admonition warning annotate">
<p class="admonition-title">Non-standard Conan Usage</p>
<p>Conan specifically tries to avoid hardcoding installation prefix into
its builds.  For the standard Conan use-case supporting product
development and release, hardcoded paths work against portability.</p>
<p>When adding support for our <code>install_prefix</code> option, make sure to do
so in a way that does not break the standard use case!</p>
</div>
<h2 id="local-conan-recipe-index">Local Conan recipe index<a class="headerlink" href="#local-conan-recipe-index" title="Permanent link">#</a></h2>
<p>Since we need to modify some recipes, you may wish to fork the public
ConanCenter recipe database if you're not writing your own recipes from
scratch.  You will need custom recipes for any special build configurations
not already supported by package options,</p>
<ul>
<li><a href="https://docs.conan.io/2/tutorial/conan_repositories/setup_local_recipes_index.html">https://docs.conan.io/2/tutorial/conan_repositories/setup_local_recipes_index.html</a></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>$<span class="w"> </span>conan<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>conancenter-local<span class="w"> </span>./conan-center-index
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>$<span class="w"> </span>conan<span class="w"> </span>remote<span class="w"> </span>disable<span class="w"> </span>conancenter
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>conancenter:<span class="w"> </span>https://center2.conan.io<span class="w"> </span><span class="o">[</span>Verify<span class="w"> </span>SSL:<span class="w"> </span>True,<span class="w"> </span>Enabled:<span class="w"> </span>False<span class="o">]</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>$<span class="w"> </span>conan<span class="w"> </span>remote<span class="w"> </span>list
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>conancenter:<span class="w"> </span>https://center2.conan.io<span class="w"> </span><span class="o">[</span>Verify<span class="w"> </span>SSL:<span class="w"> </span>True,<span class="w"> </span>Enabled:<span class="w"> </span>False<span class="o">]</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>conancenter-local:<span class="w"> </span>/workspaces/ConanToolchain/src/demo/toolchain/conan-center-index<span class="w"> </span><span class="o">[</span>local-recipes-index,<span class="w"> </span>Enabled:<span class="w"> </span>True<span class="o">]</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>$<span class="w"> </span>
</span></code></pre></div>
<h3 id="maintaining-the-conan-package-index">Maintaining the Conan Package Index<a class="headerlink" href="#maintaining-the-conan-package-index" title="Permanent link">#</a></h3>
<div class="language-text highlight"><span class="filename">Sample Conan Package Index Directory Tree</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>recipes
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>├── gcc
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>│   └── all
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>│       ├── conandata.yml
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>│       ├── conanfile.py
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>│       └── test_package
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>└── binutils
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    └── all
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>        ├── conandata.yml
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        ├── conanfile.py
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>        └── test_package
</span></code></pre></div>
<h2 id="common-issues-with-conan-center-index-packages-for-system-package-deployment">Common Issues with conan-center-index packages for System Package deployment<a class="headerlink" href="#common-issues-with-conan-center-index-packages-for-system-package-deployment" title="Permanent link">#</a></h2>
<h3 id="license-file-conflicts">license File Conflicts<a class="headerlink" href="#license-file-conflicts" title="Permanent link">#</a></h3>
<p>It looks like conan-center-index packages like to store a copy of their license
files into a common path /opt/toolchain/licenses/.  So we need to make sure our
ownership of such files is minimized to avoid conflicts.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>root@927e783639d8:/workspaces/conan-system-packaging/demo#<span class="w"> </span>dpkg<span class="w"> </span>--install<span class="w"> </span>deb_deploy/*.deb
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="o">(</span>Reading<span class="w"> </span>database<span class="w"> </span>...<span class="w"> </span><span class="m">29691</span><span class="w"> </span>files<span class="w"> </span>and<span class="w"> </span>directories<span class="w"> </span>currently<span class="w"> </span>installed.<span class="o">)</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="o">[</span>...<span class="o">]</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>Preparing<span class="w"> </span>to<span class="w"> </span>unpack<span class="w"> </span>.../opt+toolchain-mpfr_4.2.0-1_arm64.deb<span class="w"> </span>...
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>Unpacking<span class="w"> </span>opt+toolchain-mpfr<span class="w"> </span><span class="o">(</span><span class="m">4</span>.2.0-1<span class="o">)</span><span class="w"> </span>...
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>dpkg:<span class="w"> </span>error<span class="w"> </span>processing<span class="w"> </span>archive<span class="w"> </span>deb_deploy/opt+toolchain-mpfr_4.2.0-1_arm64.deb<span class="w"> </span><span class="o">(</span>--install<span class="o">)</span>:
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="hll"><span class="w"> </span>trying<span class="w"> </span>to<span class="w"> </span>overwrite<span class="w"> </span><span class="s1">&#39;/opt/toolchain/licenses/COPYING.LESSER&#39;</span>,<span class="w"> </span>which<span class="w"> </span>is<span class="w"> </span>also<span class="w"> </span><span class="k">in</span><span class="w"> </span>package<span class="w"> </span>opt+toolchain-mpc<span class="w"> </span><span class="m">1</span>.2.0-1
</span></span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="o">[</span>...<span class="o">]</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>dpkg:<span class="w"> </span>error<span class="w"> </span>processing<span class="w"> </span>archive<span class="w"> </span>deb_deploy/opt+toolchain-zlib_1.3.1-1_arm64.deb<span class="w"> </span><span class="o">(</span>--install<span class="o">)</span>:
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="hll"><span class="w"> </span>trying<span class="w"> </span>to<span class="w"> </span>overwrite<span class="w"> </span><span class="s1">&#39;/opt/toolchain/licenses/LICENSE&#39;</span>,<span class="w"> </span>which<span class="w"> </span>is<span class="w"> </span>also<span class="w"> </span><span class="k">in</span><span class="w"> </span>package<span class="w"> </span>opt+toolchain-isl<span class="w"> </span><span class="m">0</span>.26-1
</span></span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="o">[</span>...<span class="o">]</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>root@927e783639d8:/workspaces/conan-system-packaging/demo#<span class="w"> </span>
</span></code></pre></div>
<h4 id="fixing-it-in-conanfilepy">Fixing it in conanfile.py<a class="headerlink" href="#fixing-it-in-conanfilepy" title="Permanent link">#</a></h4>
<p>This is the ideal option, but implies you are now forked from
<code>conan-center-index</code> and off to the races keeping your fork up-to-date.
Take heart, brave solider!</p>
<p>In the case of zlib, the simplest path is to just behave differently if
our <code>install_prefix</code> option is specified.  This is not a very self-defending
approach though.  Package maintainers not needing <code>install_prefix</code> might
not pay attention to <code>install_prefix</code>-related regressions.</p>
<div class="language-diff highlight"><span class="filename">Sample Conan Package Index Directory Tree</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>root@927e783639d8:/workspaces/conan-system-packaging/demo/conan-center-index# git diff recipes/zlib/all/conanfile.py
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="gh">diff --git a/recipes/zlib/all/conanfile.py b/recipes/zlib/all/conanfile.py</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="gh">index 717b2e9d8..c67082c9a 100644</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="gd">--- a/recipes/zlib/all/conanfile.py</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="gi">+++ b/recipes/zlib/all/conanfile.py</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="gu">@@ -21,10 +21,12 @@ class ZlibConan(ConanFile):</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w"> </span>    options = {
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w"> </span>        &quot;shared&quot;: [True, False],
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w"> </span>        &quot;fPIC&quot;: [True, False],
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="gi">+        &quot;install_prefix&quot;: [None, &quot;ANY&quot;],</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w"> </span>    }
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w"> </span>    default_options = {
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w"> </span>        &quot;shared&quot;: False,
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w"> </span>        &quot;fPIC&quot;: True,
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="gi">+        &quot;install_prefix&quot;: None,</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w"> </span>    }
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w"> </span>    def export_sources(self):
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="gu">@@ -87,7 +89,11 @@ class ZlibConan(ConanFile):</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w"> </span>        return license_contents
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w"> </span>    def package(self):
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="gd">-        save(self, os.path.join(self.package_folder, &quot;licenses&quot;, &quot;LICENSE&quot;), self._extract_license())</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="gi">+        if self.options.install_prefix:</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="gi">+            save(self, os.path.join(self.package_folder, &quot;licenses&quot;, self.name, &quot;LICENSE&quot;), self._extract_license())</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="gi">+        else:</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="gi">+            save(self, os.path.join(self.package_folder, &quot;licenses&quot;, &quot;LICENSE&quot;), self._extract_license())</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="gi">+</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w"> </span>        cmake = CMake(self)
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w"> </span>        cmake.install()
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>root@927e783639d8:/workspaces/conan-system-packaging/demo/conan-center-index#
</span></code></pre></div>
<h4 id="overriding-it-in-deployer">Overriding it in deployer<a class="headerlink" href="#overriding-it-in-deployer" title="Permanent link">#</a></h4>
<p>This is our fail-safest option, where we hardcode specific paths to ignore
or modify as appropriate.  We'll have to figure out a better solution
eventually.</p>
<div class="language-diff highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="w"> </span>    # Copy the package content out of the Conan cache
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w"> </span>    copy(conanfile=conanfile,
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w"> </span>         src=dependency_item.package_folder,
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w"> </span>         excludes=[&#39;conaninfo.txt&#39;,
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w"> </span>                   &#39;conanmanifest.txt&#39;,
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w"> </span>                   &#39;conan*.sh&#39;,
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w"> </span>                   &#39;deactivate_conan*.sh&#39;,
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w"> </span>                  ],
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w"> </span>         dst=pkg_dst,
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w"> </span>         pattern=copy_pattern,
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w"> </span>        )
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="gi">+    # CONFLICT Avoid - Move typically reused license file paths to package-specific paths</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="gi">+    for license_file in [&#39;COPYING&#39;, &#39;LICENSE&#39;, &#39;LICENSES&#39;, &#39;COPYING.LESSER&#39;, &#39;COPYING.LESSERv3&#39;, &#39;COPYINGv2&#39;,]:</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="gi">+        if os.path.exists(os.path.join(pkg_dst, &#39;licenses&#39;, license_file)):</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="gi">+            mkdir(conanfile=conanfile,</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="gi">+                  path=os.path.join(pkg_dst, &#39;licenses&#39;, dependency_item.ref.name),</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="gi">+            )</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="gi">+            rm(conanfile=conanfile,</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="gi">+               folder=os.path.join(pkg_dst, &#39;licenses&#39;, dependency_item.ref.name),</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="gi">+               pattern=os.path.join(license_file),</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="gi">+            )</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="gi">+            rename(conanfile=conanfile,</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="gi">+                   src=os.path.join(pkg_dst, &#39;licenses&#39;, license_file),</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="gi">+                   dst=os.path.join(pkg_dst, &#39;licenses&#39;, dependency_item.ref.name, license_file),</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="gi">+            )</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="gi">+            rm(conanfile=conanfile,</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="gi">+               folder=os.path.join(pkg_dst, &#39;licenses&#39;),</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="gi">+               pattern=os.path.join(license_file),</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="gi">+            )</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="gi">+</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="w"> </span>    # Copy the template content from the deployer installation
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a><span class="w"> </span>    copy(conanfile=conanfile,
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a><span class="w"> </span>         src=deb_template_path,
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>root@927e783639d8:/workspaces/conan-system-packaging# 
</span></code></pre></div>
<h3 id="other-conflicts">Other Conflicts<a class="headerlink" href="#other-conflicts" title="Permanent link">#</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="o">[</span>root@26c288a0b66e<span class="w"> </span>demo<span class="o">]</span><span class="c1"># rpm --install --package rpm_deploy/RPM_HOME/rpmbuild/RPMS/aarch64/opt-toolchain-*rpm</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">        </span>file<span class="w"> </span>/opt/toolchain/share/info/dir<span class="w"> </span>conflicts<span class="w"> </span>between<span class="w"> </span>attempted<span class="w"> </span>installs<span class="w"> </span>of<span class="w"> </span>opt-toolchain-binutils-2.42-1.el9.aarch64<span class="w"> </span>and<span class="w"> </span>opt-toolchain-make-4.4.1-1.el9.aarch64
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="o">[</span>root@26c288a0b66e<span class="w"> </span>demo<span class="o">]</span><span class="c1"># </span>
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../SampleUsage/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Sample Usage">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Sample Usage
              </div>
            </div>
          </a>
        
        
          
          <a href="../CIWorkflows/" class="md-footer__link md-footer__link--next" aria-label="Next: CI Workflows">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                CI Workflows
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2025, David L. Armstrong.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.annotate", "navigation.footer"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>