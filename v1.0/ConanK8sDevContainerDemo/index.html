<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://daversomethingsomethingorg.github.io/ConanToolchain/v1.0/ConanK8sDevContainerDemo/">
      
      
        <link rel="prev" href="../ConanZFSDemo/">
      
      
        <link rel="next" href="../ConanK8sARCDemo/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.8">
    
    
      
        <title>Demo - Optimizing the Inner Loop with Conan and ZFS in Remote DevContainers - Toolchain Build System using Conan</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#demo-optimizing-the-inner-loop-with-conan-and-zfs-in-remote-devcontainers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Toolchain Build System using Conan" class="md-header__button md-logo" aria-label="Toolchain Build System using Conan" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Toolchain Build System using Conan
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Demo - Optimizing the Inner Loop with Conan and ZFS in Remote DevContainers
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/DaverSomethingSomethingOrg/ConanToolchain" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Toolchain Build System using Conan" class="md-nav__button md-logo" aria-label="Toolchain Build System using Conan" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    Toolchain Build System using Conan
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/DaverSomethingSomethingOrg/ConanToolchain" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ButWhy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    But Why?
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SampleUsage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ConanRecipePreReqs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conan Setup and Recipe Pre-requisites
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../CIWorkflows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI Workflows
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../DemoGcc12MultiPhase/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Demo - MultiPhase GCC12 Compiler Bootstrap
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ConanZFSDemo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Demo - Optimizing C/C++ Build Performance using Conan and OpenZFS
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Demo - Optimizing the Inner Loop with Conan and ZFS in Remote DevContainers
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Demo - Optimizing the Inner Loop with Conan and ZFS in Remote DevContainers
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspiration" class="md-nav__link">
    <span class="md-ellipsis">
      Inspiration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#related-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Related Tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scope" class="md-nav__link">
    <span class="md-ellipsis">
      Scope
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment" class="md-nav__link">
    <span class="md-ellipsis">
      Environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hardware" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#software" class="md-nav__link">
    <span class="md-ellipsis">
      Software
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#openebs-zfs-setup" class="md-nav__link">
    <span class="md-ellipsis">
      OpenEBS ZFS Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenEBS ZFS Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-openebs" class="md-nav__link">
    <span class="md-ellipsis">
      Installing OpenEBS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openebs-storageclass-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      OpenEBS StorageClass definitions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes Namespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initial-parenttoplevel-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Parent/Toplevel DataSet
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#devcontainer-pod" class="md-nav__link">
    <span class="md-ellipsis">
      DevContainer Pod
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-devcontainer" class="md-nav__link">
    <span class="md-ellipsis">
      Using the DevContainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the DevContainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#provisioning" class="md-nav__link">
    <span class="md-ellipsis">
      Provisioning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-vs-code" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting VS Code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    <span class="md-ellipsis">
      Benefits
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Benefits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-waiting-for-source-clone-or-initial-build" class="md-nav__link">
    <span class="md-ellipsis">
      No waiting for source clone or initial build
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-downloading-source-code-to-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      No downloading source code to endpoints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#native-platform-development" class="md-nav__link">
    <span class="md-ellipsis">
      Native platform development
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-development-with-optimal-text-input-latency-and-response-time" class="md-nav__link">
    <span class="md-ellipsis">
      Remote development with optimal text input latency and response time
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demo-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Demo Limitations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Demo Limitations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#provisioning-is-not-fully-optimized" class="md-nav__link">
    <span class="md-ellipsis">
      Provisioning is not fully optimized
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-certificate-authority" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Certificate Authority
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-and-resource-quotas" class="md-nav__link">
    <span class="md-ellipsis">
      Security and Resource Quotas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    <span class="md-ellipsis">
      What's Next
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ConanK8sARCDemo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Demo - Conan and ZFS and Kubernetes CI (Oh my!)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ConanK8sARCTroubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting Conan ZFS GitHub ARC Container Initialization slowness
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ConanK8sARCPerformance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Demo - Securing and Performing with our GitHub ARC deployment
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../LICENSE.txt" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apache License v2.0
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspiration" class="md-nav__link">
    <span class="md-ellipsis">
      Inspiration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#related-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Related Tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scope" class="md-nav__link">
    <span class="md-ellipsis">
      Scope
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment" class="md-nav__link">
    <span class="md-ellipsis">
      Environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hardware" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#software" class="md-nav__link">
    <span class="md-ellipsis">
      Software
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#openebs-zfs-setup" class="md-nav__link">
    <span class="md-ellipsis">
      OpenEBS ZFS Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenEBS ZFS Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-openebs" class="md-nav__link">
    <span class="md-ellipsis">
      Installing OpenEBS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openebs-storageclass-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      OpenEBS StorageClass definitions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes Namespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initial-parenttoplevel-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Parent/Toplevel DataSet
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#devcontainer-pod" class="md-nav__link">
    <span class="md-ellipsis">
      DevContainer Pod
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-devcontainer" class="md-nav__link">
    <span class="md-ellipsis">
      Using the DevContainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the DevContainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#provisioning" class="md-nav__link">
    <span class="md-ellipsis">
      Provisioning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-vs-code" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting VS Code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    <span class="md-ellipsis">
      Benefits
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Benefits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-waiting-for-source-clone-or-initial-build" class="md-nav__link">
    <span class="md-ellipsis">
      No waiting for source clone or initial build
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-downloading-source-code-to-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      No downloading source code to endpoints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#native-platform-development" class="md-nav__link">
    <span class="md-ellipsis">
      Native platform development
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-development-with-optimal-text-input-latency-and-response-time" class="md-nav__link">
    <span class="md-ellipsis">
      Remote development with optimal text input latency and response time
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demo-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Demo Limitations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Demo Limitations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#provisioning-is-not-fully-optimized" class="md-nav__link">
    <span class="md-ellipsis">
      Provisioning is not fully optimized
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-certificate-authority" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Certificate Authority
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-and-resource-quotas" class="md-nav__link">
    <span class="md-ellipsis">
      Security and Resource Quotas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    <span class="md-ellipsis">
      What's Next
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="demo-optimizing-the-inner-loop-with-conan-and-zfs-in-remote-devcontainers">Demo - Optimizing the Inner Loop with Conan and ZFS in Remote DevContainers<a class="headerlink" href="#demo-optimizing-the-inner-loop-with-conan-and-zfs-in-remote-devcontainers" title="Permanent link">#</a></h1>
<!-- markdownlint-disable MD046 -->
<!-- markdownlint-disable MD034 -->

<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">#</a></h2>
<p>We've demonstrated the benefits of Conan build avoidance with OpenZFS for
cloning our <a href="https://daversomethingsomethingorg.github.io/ConanToolchain/">Conan Toolchain</a>
build cache <a href="../ConanZFSDemo/">in our previous demo</a>.  Now how do we
extend that benefit to enhance our Developer Experience as well?</p>
<div class="admonition quote inline end">
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../img/works_on_my_machine.png" data-desc-position="bottom"><img alt="Works on my machine" src="../img/works_on_my_machine.png"></a></p>
</div>
<p>The answer is remote
<a href="https://code.visualstudio.com/docs/devcontainers/containers">DevContainers</a>
hosted in Kubernetes!</p>
<p>In addition to build performance and storage optimization, remote
DevContainers will also help secure endpoints by keeping our source code
and builds hosted in our datacenter!</p>
<p>We'll get the benefit of being able to set up our runtime environment
more similar to how we deploy production too.  Using the same container
images that our CI workflows use, with all of the same dependencies
deployed in the same manner.</p>
<p>"Works on my machine" is really starting to mean something now!</p>
<div class="admonition quote annotate">
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../img/ConanK8sDevContainerDemo%20Diagram.png" data-desc-position="bottom"><img alt="Conan and ZFS in Remote DevContainers box diagram" src="../img/ConanK8sDevContainerDemo%20Diagram.png"></a></p>
<p><em>Check out <a href="https://excalidraw.com/">Excalidraw</a> and their nifty diagramming tool!</em></p>
</div>
<h3 id="inspiration">Inspiration<a class="headerlink" href="#inspiration" title="Permanent link">#</a></h3>
<p>This was originally inspired by an article from vxlabs where they set up
Kubernetes on their development machine in order to gain remote access to
their shared VS Code development environment.</p>
<div class="admonition abstract annotate">
<p class="admonition-title">vxlabs - Using Kubernetes for development containers</p>
<p>Botha, Dr. Charl P., vxlabs (2021). <a href="https://vxlabs.com/2021/11/21/using-kubernetes-for-development-containers">"Using Kubernetes for development containers"</a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="https://vxlabs.com/2021/11/21/using-kubernetes-for-development-containers/images/kubernetes-devcontainer.svg" data-desc-position="bottom"><img alt="Diagram - Using Kubernetes for development containers" src="https://vxlabs.com/2021/11/21/using-kubernetes-for-development-containers/images/kubernetes-devcontainer.svg"></a></p>
<p>More: <a href="https://vxlabs.com/2021/11/21/using-kubernetes-for-development-containers">https://vxlabs.com/2021/11/21/using-kubernetes-for-development-containers</a></p>
</div>
<p>It turns out that VS Code can do most of the work once we have a container
Pod deployed in Kubernetes and the required VS Code plugins installed.</p>
<p>We're going to take this a bit further here and assume <strong><em>all</em></strong> access is
remote for an Enterprise-ready implementation.  We'll leverage our
centralized Kubernetes cluster for all development in order to take full
advantage of our centrally managed, scalable ZFS storage there as well.</p>
<h3 id="related-tools">Related Tools<a class="headerlink" href="#related-tools" title="Permanent link">#</a></h3>
<p>There are a few free/open-source and commercial/SaaS tool offerings in this
space, some of which provide significant value over the solution we're
presenting here.</p>
<ul>
<li><a href="https://coder.com/">Coder</a> / <a href="https://github.com/coder/envbuilder/blob/main/README.md">Envbuilder</a></li>
<li><a href="https://devpod.sh/">DevPod</a></li>
<li><a href="https://docs.github.com/en/codespaces">GitHub Codespaces</a></li>
<li><a href="https://www.loft.sh/blog/comparing-coder-vs-codespaces-vs-gitpod-vs-devpod">Gitpod vs. Codespaces vs. Coder vs. DevPod: 2024 Comparison</a></li>
</ul>
<h3 id="scope">Scope<a class="headerlink" href="#scope" title="Permanent link">#</a></h3>
<p>None of those other tools directly address the use case we're showing here
though; leveraging our copy-on-write filesystem to rapidly clone a large
build cache.  So that part is what we'll focus on in this demo.</p>
<p>We'll set up and detail the configuration for the plumbing required to
utilize DevContainer technology in bare-bones form, connecting it to
our ZFS Conan Cache clones.  We want our developers to benefit from our
ZFS-optimized builds just as much as our CI workflows do!</p>
<p>By standardizing on OpenEBS for our backend storage management, it should
be pretty straightforward to leverage ZFS in those 3rdParty solutions as
well.</p>
<h2 id="environment">Environment<a class="headerlink" href="#environment" title="Permanent link">#</a></h2>
<h3 id="hardware">Hardware<a class="headerlink" href="#hardware" title="Permanent link">#</a></h3>
<p>We'll be using the same lan and hardware setup as our previous demos.</p>
<ul>
<li>Server - AMD 8945HS/64GB/SSD</li>
<li>Workstation - AMD 9900X/32GB/SSD</li>
<li>Notebook - Macbook Pro M4 Pro</li>
<li>Network - Ubiquiti UniFi 2.5Gb/s Switch</li>
</ul>
<h3 id="software">Software<a class="headerlink" href="#software" title="Permanent link">#</a></h3>
<ul>
<li><a href="https://code.visualstudio.com/">Visual Studio Code</a><ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers">DevContainer Extension</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-kubernetes-tools.vscode-kubernetes-tools">Kubernetes Extension</a></li>
</ul>
</li>
<li><a href="https://openzfs.org/">OpenZFS</a> filesystem and storage platform</li>
<li><a href="https://openebs.io/">OpenEBS</a> with <a href="https://github.com/openebs/zfs-localpv/blob/develop/README.md">Local PV ZFS plugin</a></li>
<li><a href="https://conan.io/">Conan C/C++ Package Manager</a></li>
<li>Docker - <a href="https://github.com/DaverSomethingSomethingOrg/conan-toolchain-demo/tree/main/demos/gcc-toolchain/conan-build-container/README.md">ConanToolchain Docker Container Image</a></li>
</ul>
<h2 id="openebs-zfs-setup">OpenEBS ZFS Setup<a class="headerlink" href="#openebs-zfs-setup" title="Permanent link">#</a></h2>
<h3 id="installing-openebs">Installing OpenEBS<a class="headerlink" href="#installing-openebs" title="Permanent link">#</a></h3>
<p>Reference: <a href="https://openebs.io/docs/quickstart-guide/installation">OpenEBS Installation</a></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>❯<span class="w"> </span>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>openebs<span class="w"> </span>https://openebs.github.io/openebs
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>❯<span class="w"> </span>helm<span class="w"> </span>repo<span class="w"> </span>update
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>❯<span class="w"> </span>helm<span class="w"> </span>install<span class="w"> </span>openebs<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span>--namespace<span class="w"> </span>openebs<span class="w"> </span>openebs/openebs<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span>--set<span class="w"> </span>engines.replicated.mayastor.enabled<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="hll"><span class="w">  </span>--set<span class="w"> </span>zfs-localpv.zfsNode.kubeletDir<span class="o">=</span>/var/lib/kubelet<span class="w"> </span><span class="se">\</span>
</span></span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span>--create-namespace
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>NAME:<span class="w"> </span>openebs
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>LAST<span class="w"> </span>DEPLOYED:<span class="w"> </span>Wed<span class="w"> </span>Oct<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">08</span>:23:30<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>NAMESPACE:<span class="w"> </span>openebs
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>STATUS:<span class="w"> </span>deployed
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>REVISION:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>TEST<span class="w"> </span>SUITE:<span class="w"> </span>None
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>NOTES:
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>Successfully<span class="w"> </span>installed<span class="w"> </span>OpenEBS.
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>Check<span class="w"> </span>the<span class="w"> </span>status<span class="w"> </span>by<span class="w"> </span>running:<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>openebs
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>The<span class="w"> </span>default<span class="w"> </span>values<span class="w"> </span>will<span class="w"> </span>install<span class="w"> </span>both<span class="w"> </span>Local<span class="w"> </span>PV<span class="w"> </span>and<span class="w"> </span>Replicated<span class="w"> </span>PV.<span class="w"> </span>However,
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>the<span class="w"> </span>Replicated<span class="w"> </span>PV<span class="w"> </span>will<span class="w"> </span>require<span class="w"> </span>additional<span class="w"> </span>configuration<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>fuctional.
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>The<span class="w"> </span>Local<span class="w"> </span>PV<span class="w"> </span>offers<span class="w"> </span>non-replicated<span class="w"> </span><span class="nb">local</span><span class="w"> </span>storage<span class="w"> </span>using<span class="w"> </span><span class="m">3</span><span class="w"> </span>different<span class="w"> </span>storage
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>backends<span class="w"> </span>i.e<span class="w"> </span>Hostpath,<span class="w"> </span>LVM<span class="w"> </span>and<span class="w"> </span>ZFS,<span class="w"> </span><span class="k">while</span><span class="w"> </span>the<span class="w"> </span>Replicated<span class="w"> </span>PV<span class="w"> </span>provides<span class="w"> </span>one<span class="w"> </span>replicated<span class="w"> </span>highly-available
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>storage<span class="w"> </span>backend<span class="w"> </span>i.e<span class="w"> </span>Mayastor.
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>For<span class="w"> </span>more<span class="w"> </span>information,
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>-<span class="w"> </span>view<span class="w"> </span>the<span class="w"> </span>online<span class="w"> </span>documentation<span class="w"> </span>at<span class="w"> </span>https://openebs.io/docs
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>-<span class="w"> </span>connect<span class="w"> </span>with<span class="w"> </span>an<span class="w"> </span>active<span class="w"> </span>community<span class="w"> </span>on<span class="w"> </span>our<span class="w"> </span>Kubernetes<span class="w"> </span>slack<span class="w"> </span>channel.
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">        </span>-<span class="w"> </span>Sign<span class="w"> </span>up<span class="w"> </span>to<span class="w"> </span>Kubernetes<span class="w"> </span>slack:<span class="w"> </span>https://slack.k8s.io
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">        </span>-<span class="w"> </span><span class="c1">#openebs channel: https://kubernetes.slack.com/messages/openebs</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>❯
</span></code></pre></div>
<h3 id="openebs-storageclass-definitions">OpenEBS StorageClass definitions<a class="headerlink" href="#openebs-storageclass-definitions" title="Permanent link">#</a></h3>
<p>Now that OpenEBS is installed with Local PV ZFS, we'll create our PV and
snapshot StorageClass definitions.  We'll need to give the PV StorageClass
the name of our toplevel ZFS pool/dataset, and it's a good idea to specify
our worker node in here as well since these are Local PVs.</p>
<p>Reference: <a href="https://openebs.io/docs/user-guides/local-storage-user-guide/local-pv-zfs/configuration/zfs-create-storageclass">OpenEBS Local PV ZFS - Create StorageClass(s)</a></p>
<div class="language-yaml highlight"><span class="filename">OpenEBS StorageClass definitions</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openebs-zfspv</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="nt">allowVolumeExpansion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="nt">parameters</span><span class="p">:</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="nt">recordsize</span><span class="p">:</span><span class="w"> </span><span class="s">"128k"</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span><span class="nt">compression</span><span class="p">:</span><span class="w"> </span><span class="s">"off"</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">  </span><span class="nt">dedup</span><span class="p">:</span><span class="w"> </span><span class="s">"off"</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">  </span><span class="nt">fstype</span><span class="p">:</span><span class="w"> </span><span class="s">"zfs"</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="hll"><span class="w">  </span><span class="nt">poolname</span><span class="p">:</span><span class="w"> </span><span class="s">"zpool-conancache"</span>
</span></span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="nt">provisioner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">zfs.csi.openebs.io</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="nt">allowedTopologies</span><span class="p">:</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matchLabelExpressions</span><span class="p">:</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/hostname</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">    </span><span class="nt">values</span><span class="p">:</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="hll"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hephaestus.homelab</span>
</span></span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="nn">---</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VolumeSnapshotClass</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">snapshot.storage.k8s.io/v1</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openebs-zfspv-snapshot</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="w">    </span><span class="nt">snapshot.storage.kubernetes.io/is-default-class</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">zfs.csi.openebs.io</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="nt">deletionPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span></code></pre></div>
<h3 id="kubernetes-namespace">Kubernetes Namespace<a class="headerlink" href="#kubernetes-namespace" title="Permanent link">#</a></h3>
<p>When creating ZFS snapshot and clone PVCs, they all need to exist in the
same namespace and all need to request the same size storage resource, or
things will mysteriously not work at all.</p>
<p>For this demo we'll create a <code>devcontainer</code> namespace
<a href="https://vxlabs.com/2021/11/21/using-kubernetes-for-development-containers/#create-and-set-namespace">like vxlabs</a>.</p>
<h3 id="initial-parenttoplevel-dataset">Initial Parent/Toplevel DataSet<a class="headerlink" href="#initial-parenttoplevel-dataset" title="Permanent link">#</a></h3>
<p>We're using the same <code>zpool-conancache</code> ZFS pool from our previous demo,
but we want to create a new toplevel dataset to clone from for our Runners
and DevContainers.  Primarily to isolate our Kubernetes operations from our
raw ZFS operations in our previous demo.</p>
<p>Reference: <a href="https://openebs.io/docs/user-guides/local-storage-user-guide/local-pv-zfs/configuration/zfs-create-pvc">OpenEBS Local PV ZFS - Create PersistentVolumeClaim</a></p>
<div class="language-yaml highlight"><span class="filename">gcc12-toolchain-main_dataset.yaml</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># Initial PVC for gcc12-toolchain main branch dataset</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcc12-toolchain-main</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openebs-zfspv</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200Gi</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>❯<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>gcc12-toolchain-main_dataset.yaml<span class="w"> </span>--namespace<span class="w"> </span>devcontainer
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>persistentvolumeclaim/gcc12-toolchain-main<span class="w"> </span>created
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>❯<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pvc<span class="w"> </span>-n<span class="w"> </span>devcontainer
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>NAME<span class="w">                                           </span>STATUS<span class="w">   </span>VOLUME<span class="w">                                     </span>CAPACITY<span class="w">   </span>ACCESS<span class="w"> </span>MODES<span class="w">   </span>STORAGECLASS<span class="w">    </span>VOLUMEATTRIBUTESCLASS<span class="w">   </span>AGE
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>gcc12-toolchain-main<span class="w">                           </span>Bound<span class="w">    </span>pvc-4f9dd102-cf04-44a2-845f-733d77138a6c<span class="w">   </span>200Gi<span class="w">      </span>RWO<span class="w">            </span>openebs-zfspv<span class="w">   </span>&lt;unset&gt;<span class="w">                 </span>13d
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>❯
</span></code></pre></div>
<h2 id="devcontainer-pod">DevContainer Pod<a class="headerlink" href="#devcontainer-pod" title="Permanent link">#</a></h2>
<p>With OpenEBS set up, and ZFS ready to go, we're all set to deploy our
DevContainer!  We'll create a Pod and attach a PersistentVolumeClaim
for our Conan Cache.</p>
<p>Within the Pod we'll run an initContainer in order to clone our git repo
into a volume that gets attached to our devContainer once the clone is
ready.</p>
<p>In order to avoid file permission issues we'll want to make sure we
configure the securityContext to use the same uid/gid that owns the
files in the original dataset.  Since GitHub Actions run as <code>root</code>/<code>0</code>
by default, we'll continue that here also for convenience.</p>
<div class="admonition warning annotate">
<p class="admonition-title">Warning</p>
<p>Changing to a non-privileged user is an obvious/needed step in
securing this solution, but will need to be applied consistently
throughout all users of the ZFS dataset.</p>
</div>
<p>Reference: <a href="https://openebs.io/docs/user-guides/local-storage-user-guide/local-pv-zfs/advanced-operations/zfs-clone">OpenEBS Local PV ZFS - Clone</a></p>
<div class="language-yaml highlight"><span class="filename">devContainer-pod.yaml</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">devcontainer-pod</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conan</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="nt">cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcc12-toolchain-main</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">  </span><span class="nt">initContainers</span><span class="p">:</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-init</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">"nexus.homelab/conan-docker-build-ubuntu:x86_64-latest"</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">      </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">      </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">      </span><span class="c1">#fsGroup: 2000</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"/bin/sh"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"-c"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"git</span><span class="nv"> </span><span class="s">clone</span><span class="nv"> </span><span class="s">https://github.com/DaverSomethingSomethingOrg/conan-toolchain-demo.git</span><span class="nv"> </span><span class="s">/workspace/conan-toolchain-demo"</span><span class="p p-Indicator">]</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/workspace</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-volume</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conan-container</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">"nexus.homelab/conan-docker-build-ubuntu:x86_64-latest"</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">    </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="w">      </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="w">      </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="w">      </span><span class="c1">#fsGroup: 2000</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="w">    </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONAN_HOME</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/CONAN_HOME</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="w">    </span><span class="nt">workingDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/workspace/conan-toolchain-demo</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"/bin/sh"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"-c"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"while</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">1000;</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">:;</span><span class="nv"> </span><span class="s">done"</span><span class="p p-Indicator">]</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a><span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/workspace</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-volume</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/vscode/.cache</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache-volume</span>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a><span class="hll"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/CONAN_HOME</span>
</span></span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a><span class="hll"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conan-home</span>
</span></span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-volume</span>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a><span class="w">    </span><span class="c1"># https://kubernetes.io/docs/concepts/storage/volumes/#emptydir</span>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a><span class="w">    </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache-volume</span>
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a><span class="w">    </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-5-48"><a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a><span class="hll"><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conan-home</span>
</span></span><span id="__span-5-49"><a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a><span class="hll"><span class="w">    </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span></span><span id="__span-5-50"><a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a><span class="hll"><span class="w">      </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="s">"gcc12-toolchain-main-hephaestus-devcontainer"</span>
</span></span><span id="__span-5-51"><a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a>
</span><span id="__span-5-52"><a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a><span class="nn">---</span>
</span><span id="__span-5-53"><a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a>
</span><span id="__span-5-54"><a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a><span class="c1"># Clone CONAN_HOME directly from PVC (internal snapshot)</span>
</span><span id="__span-5-55"><a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-5-56"><a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-5-57"><a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-5-58"><a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcc12-toolchain-main-hephaestus-devcontainer</span>
</span><span id="__span-5-59"><a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-5-60"><a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openebs-zfspv</span>
</span><span id="__span-5-61"><a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a><span class="w">  </span><span class="nt">dataSource</span><span class="p">:</span>
</span><span id="__span-5-62"><a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a><span class="hll"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcc12-toolchain-main</span>
</span></span><span id="__span-5-63"><a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a><span class="hll"><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span></span><span id="__span-5-64"><a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-5-65"><a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-5-66"><a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-5-67"><a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-5-68"><a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a><span class="hll"><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200Gi</span>
</span></span></code></pre></div>
<h2 id="using-the-devcontainer">Using the DevContainer<a class="headerlink" href="#using-the-devcontainer" title="Permanent link">#</a></h2>
<h3 id="provisioning">Provisioning<a class="headerlink" href="#provisioning" title="Permanent link">#</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>❯<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>devContainer-pod.yaml<span class="w"> </span>--namespace<span class="w"> </span>devcontainer
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>persistentvolumeclaim/gcc12-toolchain-main<span class="w"> </span>created
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>❯<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pvc<span class="w"> </span>--namespace<span class="w"> </span>devcontainer<span class="w"> </span>--type<span class="w"> </span>all
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>NAME<span class="w">                                           </span>STATUS<span class="w">   </span>VOLUME<span class="w">                                     </span>CAPACITY<span class="w">   </span>ACCESS<span class="w"> </span>MODES<span class="w">   </span>STORAGECLASS<span class="w">    </span>VOLUMEATTRIBUTESCLASS<span class="w">   </span>AGE
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>gcc12-toolchain-main<span class="w">                           </span>Bound<span class="w">    </span>pvc-4f9dd102-cf04-44a2-845f-733d77138a6c<span class="w">   </span>200Gi<span class="w">      </span>RWO<span class="w">            </span>openebs-zfspv<span class="w">   </span>&lt;unset&gt;<span class="w">                 </span>13d
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>gcc12-toolchain-main-hephaestus-devcontainer<span class="w">   </span>Bound<span class="w">    </span>pvc-005c989b-75e4-485f-9a19-59877deaa3af<span class="w">   </span>200Gi<span class="w">      </span>RWO<span class="w">            </span>openebs-zfspv<span class="w">   </span>&lt;unset&gt;<span class="w">                 </span>11d
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>❯
</span></code></pre></div>
<p>We can verify the snapshot/clone linkage in ZFS.  The naming is chosen
by OpenEBS internally.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>❯<span class="w"> </span>zfs<span class="w"> </span>list<span class="w"> </span>-t<span class="w"> </span>all<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span><span class="s1">'\(pvc-4f9dd102\|pvc-005c989b\)'</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>zpool-conancache/pvc-4f9dd102-cf04-44a2-845f-733d77138a6c<span class="w">                                           </span><span class="m">20</span>.6G<span class="w">   </span>161G<span class="w">  </span><span class="m">20</span>.6G<span class="w">  </span>legacy
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>zpool-conancache/pvc-4f9dd102-cf04-44a2-845f-733d77138a6c@pvc-005c989b-75e4-485f-9a19-59877deaa3af<span class="w">     </span>0B<span class="w">      </span>-<span class="w">  </span><span class="m">20</span>.6G<span class="w">  </span>-
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>zpool-conancache/pvc-005c989b-75e4-485f-9a19-59877deaa3af<span class="w">                                            </span>496K<span class="w">   </span>161G<span class="w">  </span><span class="m">20</span>.5G<span class="w">  </span>legacy
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>❯
</span></code></pre></div>
<h3 id="connecting-vs-code">Connecting VS Code<a class="headerlink" href="#connecting-vs-code" title="Permanent link">#</a></h3>
<p>The Pod is running, source repo has been <code>git</code> cloned, and cache volume
has been <code>zfs</code> cloned.  We're ready to connect our VS Code instance and
get to productive!</p>
<ul>
<li><a href="https://code.visualstudio.com/docs/devcontainers/attach-container#_attach-to-a-container-in-a-kubernetes-cluster">VS Code Documentation: Attach to a container in a Kubernetes cluster</a></li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../img/vscode_attach_devcontainer.png" data-desc-position="bottom"><img alt="VS Code - attach to DevContainer" src="../img/vscode_attach_devcontainer.png"></a></p>
<p>Once attached, chose "Open Folder" and navigate to the <code>/workspace/repoName</code>
directory where we mounted our <code>code-volume</code>.</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../img/vscode_open_folder_devcontainer.png" data-desc-position="bottom"><img alt="VS Code - open folder in DevContainer" src="../img/vscode_open_folder_devcontainer.png"></a></p>
<p><strong>DONE!</strong>  We have a working Conan dev environment with a pre-populated
local cache.</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../img/vscode_attached_and_ready.png" data-desc-position="bottom"><img alt="VS Code - attached and ready" src="../img/vscode_attached_and_ready.png"></a></p>
<h2 id="benefits">Benefits<a class="headerlink" href="#benefits" title="Permanent link">#</a></h2>
<h3 id="no-waiting-for-source-clone-or-initial-build">No waiting for source clone or initial build<a class="headerlink" href="#no-waiting-for-source-clone-or-initial-build" title="Permanent link">#</a></h3>
<p>Remote-managing our developer sandboxes means we can keep a few spare
devcontainer pods waiting in a warm-standby pool.  Similar to the way
we also keep a minimum number of CI runners ready to start jobs with
no delay.</p>
<p>When a developer needs a new workspace, we'll just assign one of our
standby devcontainer pods to them, switch to their desired branch, and
they're off to the races.</p>
<h3 id="no-downloading-source-code-to-endpoints">No downloading source code to endpoints<a class="headerlink" href="#no-downloading-source-code-to-endpoints" title="Permanent link">#</a></h3>
<p>We already take a variety of steps to avoid having developers download our
company's intellectual property onto their notebooks and mobile endpoints.
Let's make this a positive aspect of their experience rather than a source
of friction to getting their job done.</p>
<p>Not only does this solution avoid having our code exposed on a stolen
or compromised endpoint, developers won't want to wait for it to download!</p>
<h3 id="native-platform-development">Native platform development<a class="headerlink" href="#native-platform-development" title="Permanent link">#</a></h3>
<p>When your development environments run in a similar or the same
environment as production, your endpoint platform is less of a concern.
In this demo the Kubernetes worker node is running Ubuntu x86_64, while
the developer notebook is an Apple Silicon ARM-based Macbook.  With
Docker Desktop and DevContainers it is pretty straightforward to run
our x86_64 DevContainers, but we pay a severe performance penalty with
all commands being wrapped by QEMU emulation.</p>
<p>Allowing developers to work on their preferred productivity platform
while eliminating any potential compatibility issues is a huge win for
developer happiness.</p>
<h3 id="remote-development-with-optimal-text-input-latency-and-response-time">Remote development with optimal text input latency and response time<a class="headerlink" href="#remote-development-with-optimal-text-input-latency-and-response-time" title="Permanent link">#</a></h3>
<p>Remote desktop display and VDI options have always been a sub-optimal
developer experience due to high latency in textual input due to
transmitting the full graphical environment.  This solution keeps the
graphics interaction local. Just the text input and output are transmitted
while editing code.</p>
<h2 id="demo-limitations">Demo Limitations<a class="headerlink" href="#demo-limitations" title="Permanent link">#</a></h2>
<p>We've taken some shortcuts in setting up this demo.  Here are some of the
areas we'd definitely want to tackle before implementing this solution
in a production engineering environment.</p>
<h3 id="provisioning-is-not-fully-optimized">Provisioning is not fully optimized<a class="headerlink" href="#provisioning-is-not-fully-optimized" title="Permanent link">#</a></h3>
<p>In order to eek out every bit of performance from a remote DevContainer,
we'd want to install <a href="https://code.visualstudio.com/docs/remote/vscode-server"><code>vscode-server</code></a>
using our initContainer and have it running and waiting for remote
connection prior to the developer attaching to it.</p>
<p>For this demo we rely on VS Code doing the legwork of finalizing the
DevContainer setup for us, including downloading and installing
<code>vscode-server</code> and Node.js when attaching.  This can be very slow if done
over a low-bandwidth remote connection.  <em>(I've done this from a coffee
shop and it's not an enjoyable developer experience!)</em></p>
<h3 id="custom-certificate-authority">Custom Certificate Authority<a class="headerlink" href="#custom-certificate-authority" title="Permanent link">#</a></h3>
<p>The container image we use in our DevContainer is already configured with
our custom internal Certificate Authority (CA).  For CI jobs, GitHub Actions
Runner Controller (ARC) provides custom certificates through a Vault or
ConfigMap mounted into the Runner containers.  Ideally we would do the same
for DevContainers for consistency and to avoid needing a customized
container base image.</p>
<h3 id="security-and-resource-quotas">Security and Resource Quotas<a class="headerlink" href="#security-and-resource-quotas" title="Permanent link">#</a></h3>
<p>Yeah, we didn't bother with any of this nonsense (tongue-in-cheek) for
this demo, but our GitHub ARC solution (coming up in our next demo!)
handles these issues from the CI point of view.  We'll want to set up our
DevContainers with a compatible security model.</p>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">#</a></h2>
<p>Modern technologies like Kubernetes and DevContainers bring a lot to the
table for delivering the full power of scalable high-performance
infrastructure right to the developer's desktop environment without
having to sacrifice on developer experience.</p>
<p>In this demo we showed how to leverage our ZFS snapshot and clone
functionality for Conan build optimization in the developer's sandbox.</p>
<p>Many engineering organizations are already using NetApp storage and
Kubernetes.  With some creativity, a few config files, and integration
scripts we can extract far more value out of the infrastructure we
already have.  Improving developer happiness significantly in the
process.</p>
<h2 id="whats-next">What's Next<a class="headerlink" href="#whats-next" title="Permanent link">#</a></h2>
<p>For our next demo we'll reimplement our raw ZFS CI solution for Conan
build performance using OpenZFS, OpenEBS, and GitHub Actions Runner
Controller (ARC).</p>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">#</a></h2>
<ul>
<li><a href="https://daversomethingsomethingorg.github.io/ConanToolchain/">Toolchain Build System using Conan</a></li>
<li><a href="https://vxlabs.com/2021/11/21/using-kubernetes-for-development-containers/">vxlabs - Using Kubernetes for development containers</a></li>
<li><a href="https://openebs.io/docs/user-guides/local-storage-user-guide/local-pv-zfs/zfs-overview">OpenEBS Local PV ZFS - Overview</a></li>
<li><a href="https://github.com/openebs/zfs-localpv/blob/develop/README.md">OpenEBS Local PV ZFS - GitHub / docs</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer">
        
          
          <a href="../ConanZFSDemo/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Demo - Optimizing C/C++ Build Performance using Conan and OpenZFS">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Demo - Optimizing C/C++ Build Performance using Conan and OpenZFS
              </div>
            </div>
          </a>
        
        
          
          <a href="../ConanK8sARCDemo/" class="md-footer__link md-footer__link--next" aria-label="Next: Demo - Conan and ZFS and Kubernetes CI (Oh my!)">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Demo - Conan and ZFS and Kubernetes CI (Oh my!)
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2025, David L. Armstrong.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.annotate", "navigation.footer"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>